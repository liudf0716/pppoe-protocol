<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PPPoE 拨号抓包流程 — 演示幻灯片</title>
  <style>
    :root {
      --bg1: #0f172a;
      /* deep */
      --bg2: #0b1220;
      --accent: #ff9a28;
      --cyan: #06b6d4;
      --muted: #9aa6b2;
      --card: #111827;
      --glass: rgba(255, 255, 255, 0.04);
      --max-w: 1200px;
      --slide-transition: transform 700ms cubic-bezier(.2, .9, .2, 1), opacity 450ms ease;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color: #e6eef6
    }

    .stage {
      width: 100%;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 24px;
      box-sizing: border-box;
    }

    .deck {
      width: 100%;
      max-width: var(--max-w);
      height: 72vh;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      box-shadow: 0 10px 40px rgba(2, 6, 23, 0.7);
      overflow: hidden;
      position: relative
    }

    .slides {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slide {
      width: 100%;
      height: 100%;
      padding: 44px;
      box-sizing: border-box;
      position: absolute;
      left: 0;
      top: 0;
      transform-origin: center center;
      display: flex;
      gap: 28px;
      align-items: flex-start;
      justify-content: flex-start;
    }

    .slide.inactive {
      opacity: 0;
      pointer-events: none;
      transform: translateX(30px) scale(.98)
    }

    .slide.active {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(0) scale(1)
    }

    /* Left column content */
    .left {
      flex: 0 0 48%;
      display: flex;
      flex-direction: column;
      gap: 16px
    }

    .title {
      font-size: 28px;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0.2px
    }

    .subtitle {
      color: var(--muted);
      font-size: 13px
    }

    .card {
      background: var(--card);
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(2, 6, 23, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.02)
    }

    .bullet {
      display: flex;
      gap: 12px;
      align-items: flex-start
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      margin-top: 6px
    }

    .muted {
      color: var(--muted);
      font-size: 13px
    }

    /* Right column sample visuals */
    .right {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: stretch
    }

    .mock-phone {
      flex: 1;
      border-radius: 14px;
      background: linear-gradient(180deg, #071022, #0f2638);
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      display: flex;
      flex-direction: column
    }

    .screen {
      flex: 1;
      border-radius: 10px;
      background: linear-gradient(180deg, #071a2a, #052033);
      display: flex;
      flex-direction: column;
      padding: 14px;
      gap: 8px;
      overflow-y: auto
    }

    .tweet {
      display: none
    }

    .packet-log {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      font-size: 12px;
      font-family: ui-monospace, monospace
    }

    .packet-log:last-child {
      border-bottom: none
    }

    .packet-log .time {
      color: var(--muted);
      width: 45px;
      flex-shrink: 0
    }

    .packet-log .proto {
      color: var(--accent);
      font-weight: 600;
      width: 40px;
      flex-shrink: 0
    }

    .packet-log .info {
      color: #cbd5e1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis
    }

    .chip {
      background: var(--glass);
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 12px;
      color: var(--muted)
    }

    .log-divider {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--muted);
      background: rgba(255, 255, 255, 0.05);
      padding: 4px 8px;
      border-radius: 4px;
      margin: 4px 0;
      font-weight: 600;
      align-self: flex-start;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 300ms ease;
    }

    .modal.open {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      width: 90%;
      max-width: 400px;
      height: 80vh;
      background: #0f172a;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      padding: 20px;
      transform: scale(0.95);
      transition: transform 300ms cubic-bezier(.2, .9, .2, 1);
    }

    .modal.open .modal-content {
      transform: scale(1);
    }

    .clickable {
      cursor: pointer;
      transition: transform 200ms ease, box-shadow 200ms ease;
    }

    .clickable:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
      border-color: var(--accent);
    }

    .summary-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.02);
    }

    .summary-icon {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
      font-weight: bold;
      font-size: 12px;
    }

    /* Sequence Diagram Styles */
    .sequence-stage {
      position: relative;
      flex: 1;
      display: flex;
      justify-content: space-between;
      padding: 0 40px;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .actor-line {
      width: 2px;
      background: rgba(255, 255, 255, 0.1);
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .actor-label {
      background: var(--card);
      padding: 4px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 12px;
      font-weight: bold;
      color: var(--muted);
      margin-bottom: 20px;
      z-index: 2;
    }

    .seq-msg {
      position: absolute;
      left: 0;
      right: 0;
      height: 30px;
      display: flex;
      align-items: center;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 300ms, transform 300ms;
    }

    .seq-msg.show {
      opacity: 1;
      transform: translateY(0);
    }

    .arrow {
      height: 2px;
      background: var(--accent);
      position: absolute;
      top: 50%;
      width: 0;
      transition: width 600ms ease-out;
    }

    .arrow::after {
      content: '';
      position: absolute;
      top: -4px;
      width: 0;
      height: 0;
      border-top: 5px solid transparent;
      border-bottom: 5px solid transparent;
    }

    /* Client -> Server */
    .c2s .arrow {
      left: 42px;
      /* offset from actor line */
    }

    .c2s .arrow::after {
      right: -5px;
      border-left: 8px solid var(--accent);
    }

    /* Server -> Client */
    .s2c .arrow {
      right: 42px;
      background: var(--cyan);
    }

    .s2c .arrow::after {
      left: -5px;
      border-right: 8px solid var(--cyan);
    }

    .msg-text {
      position: absolute;
      width: 100%;
      text-align: center;
      top: -16px;
      font-size: 11px;
      color: #cbd5e1;
      font-family: monospace;
    }

    .msg-time {
      position: absolute;
      left: -30px;
      font-size: 10px;
      color: var(--muted);
      top: 8px;
    }

    /* nav */
    .nav {
      position: absolute;
      left: 18px;
      bottom: 18px;
      display: flex;
      gap: 10px;
      align-items: center
    }

    .btn {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.03);
      padding: 8px 12px;
      border-radius: 10px;
      color: var(--muted);
      cursor: pointer
    }

    .btn:active {
      transform: translateY(1px)
    }

    .pager {
      position: absolute;
      right: 18px;
      bottom: 18px;
      color: var(--muted);
      font-size: 13px
    }

    /* progress */
    .progress {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 4px;
      background: linear-gradient(90deg, rgba(255, 154, 40, 0.18), rgba(6, 182, 212, 0.08));
    }

    .progress>i {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--cyan));
      width: 0%;
      transition: width 600ms cubic-bezier(.2, .9, .2, 1)
    }

    /* header */
    .deckHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.02)
    }

    .logo {
      display: flex;
      gap: 12px;
      align-items: center
    }

    .logoMark {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--accent), var(--cyan));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700
    }

    .logoText {
      font-size: 14px;
      font-weight: 600
    }

    /* small screens */
    @media (max-width:900px) {
      .left {
        flex-basis: 100%
      }

      .right {
        display: none
      }

      .slide {
        padding: 20px
      }
    }

    /* code block style for protocol fields */
    .proto {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      padding: 12px;
      border-radius: 10px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size: 13px;
      color: #dbeafe
    }

    /* subtle particles */
    .particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.5
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 154, 40, 0.12), rgba(255, 154, 40, 0.02));
      width: 80px;
      height: 80px;
      filter: blur(14px)
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="deck" role="application" aria-label="PPPoE 演示">

      <div class="deckHeader">
        <div class="logo">
          <div class="logoMark">PJ</div>
          <div>
            <div class="logoText">PPPoE 拨号抓包分析</div>
            <div class="muted" style="font-size:12px">技术演示 · Discovery / LCP / IPCP / LCP Echo</div>
          </div>
        </div>
        <div class="muted">按 ← → 翻页 • 空格开始</div>
      </div>

      <div class="slides" id="slides">

        <!-- Slide 1: Cover -->
        <section class="slide active" data-index="0" id="s0">
          <div class="left">
            <div class="title">PPPoE 拨号全流程概览</div>
            <div class="subtitle">从发现（Discovery）到链路（LCP）、网络（IPCP），再到保活（LCP Echo）——逐层抓包解析</div>
            <div class="card">
              <div class="muted">本演示包含：</div>
              <div style="height:12px"></div>
              <div class="bullet">
                <div class="dot"></div>
                <div><b>PPPoE Discovery</b>
                  <div class="muted">PADI / PADO / PADR / PADS / PADT</div>
                </div>
              </div>
              <div class="bullet">
                <div class="dot"></div>
                <div><b>PPP LCP</b>
                  <div class="muted">Configure-Req/Ack/Nak、认证协商</div>
                </div>
              </div>
              <div class="bullet">
                <div class="dot"></div>
                <div><b>IPCP 深析</b>
                  <div class="muted">NAK 的语义、IP/DNS 分配、双向协商</div>
                </div>
              </div>
              <div class="bullet">
                <div class="dot"></div>
                <div><b>LCP Echo 保活</b>
                  <div class="muted">链路存活检测与超时策略</div>
                </div>
              </div>
            </div>
          </div>
          <div class="right">
            <div class="mock-phone card clickable" id="overviewCard" title="点击查看详细报文流程">
              <div class="chip muted">PPPoE Flow Analysis (Summary)</div>
              <div class="screen" style="overflow:hidden; justify-content:center; gap:16px">
                <div class="summary-item">
                  <div class="summary-icon">DIS</div>
                  <div>
                    <div style="font-size:14px;font-weight:600">Discovery</div>
                    <div class="muted" style="font-size:12px">PADI / PADO / PADR / PADS</div>
                  </div>
                </div>
                <div class="summary-item">
                  <div class="summary-icon">LCP</div>
                  <div>
                    <div style="font-size:14px;font-weight:600">Link Control</div>
                    <div class="muted" style="font-size:12px">Magic Number / MRU</div>
                  </div>
                </div>
                <div class="summary-item">
                  <div class="summary-icon">AUTH</div>
                  <div>
                    <div style="font-size:14px;font-weight:600">Authentication</div>
                    <div class="muted" style="font-size:12px">PAP / CHAP</div>
                  </div>
                </div>
                <div class="summary-item">
                  <div class="summary-icon">IPCP</div>
                  <div>
                    <div style="font-size:14px;font-weight:600">Network Layer</div>
                    <div class="muted" style="font-size:12px">IP Address / DNS</div>
                  </div>
                </div>
                <div style="text-align:center;font-size:12px;color:var(--accent);margin-top:8px">
                  Click to view full packet flow ➜
                </div>
              </div>
              <div style="display:flex;gap:10px;margin-top:10px;align-items:center;justify-content:space-between">
                <div class="muted">Session ID: <b>0x1A2B</b></div>
                <div class="chip">ppp0 • up</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Slide 2: Discovery deep -->
        <section class="slide inactive" data-index="1" id="s1">
          <div class="left">
            <div class="title">PPPoE Discovery & Termination</div>
            <div class="subtitle">PADI → PADO → PADR → PADS (建立) / PADT (断开)</div>
            <div class="card" style="display:flex;flex-direction:column;gap:12px">
              <div class="muted">Discovery 阶段交互细节：</div>

              <div class="summary-item">
                <div class="summary-icon">PADI</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Initiation (Broadcast)</div>
                  <div class="muted" style="font-size:12px">Code=0x09 • Find ACs</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:var(--cyan)">PADO</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Offer (Unicast)</div>
                  <div class="muted" style="font-size:12px">AC-Name / Service-Name</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon">PADR</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Request (Unicast)</div>
                  <div class="muted" style="font-size:12px">Select specific AC</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:var(--cyan)">PADS</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Session Confirm</div>
                  <div class="muted" style="font-size:12px">Session ID assigned</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:#ef4444">PADT</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Terminate</div>
                  <div class="muted" style="font-size:12px">Sent by Client or Server</div>
                </div>
              </div>

            </div>
          </div>
          <div class="right">
            <div class="mock-phone card">
              <div class="chip muted">Ethernet Discovery • 0x8863</div>
              <div class="screen">
                <div class="log-divider">Packet Capture</div>

                <div class="packet-log">
                  <span class="time">0.000</span>
                  <span class="proto">PADI</span>
                  <span class="info">Dst: Broadcast (FF:FF:..)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.002</span>
                  <span class="proto" style="color:var(--cyan)">PADO</span>
                  <span class="info">Dst: Client (Unicast)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.003</span>
                  <span class="proto">PADR</span>
                  <span class="info">Dst: Server (Unicast)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.005</span>
                  <span class="proto" style="color:var(--cyan)">PADS</span>
                  <span class="info">Session ID: 0x1A2B</span>
                </div>

                <div class="log-divider" style="margin-top:12px">Teardown</div>

                <div class="packet-log">
                  <span class="time">10.50</span>
                  <span class="proto" style="color:#ef4444">PADT</span>
                  <span class="info">Code: 0xA7 (Term Req)</span>
                </div>

              </div>
            </div>
          </div>
        </section>

        <!-- Slide 3: LCP -->
        <section class="slide inactive" data-index="2" id="s2">
          <div class="left">
            <div class="title">PPP LCP（链路协商）</div>
            <div class="subtitle">双向协商 MRU、Magic Number、Auth Protocol</div>
            <div class="card" style="display:flex;flex-direction:column;gap:12px">
              <div class="muted">LCP 协商分为三个阶段：</div>

              <div class="summary-item">
                <div class="summary-icon">REQ</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Bidirectional Request</div>
                  <div class="muted" style="font-size:12px">Both sides send Conf-Req</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:var(--cyan)">ACK</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Bidirectional Ack</div>
                  <div class="muted" style="font-size:12px">Must Ack peer's params</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon">AUTH</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Authentication</div>
                  <div class="muted" style="font-size:12px">PAP / CHAP (After LCP Open)</div>
                </div>
              </div>

              <div style="height:1px;background:rgba(255,255,255,0.1);margin:4px 0"></div>
              <div class="muted" style="font-size:12px">
                注：最终认证方式以 Server 端 Conf-Req 中指定的为准（通常是 PAP/CHAP）。
              </div>
            </div>
          </div>
          <div class="right">
            <div class="mock-phone card">
              <div class="chip muted">LCP Negotiation • 0xC021</div>
              <div class="screen">
                <div class="log-divider">Phase 1: Configure</div>

                <div class="packet-log">
                  <span class="time">0.010</span>
                  <span class="proto">LCP</span>
                  <span class="info">C→S Conf-Req (MRU=1480 MAGIC NUM=0x12345678)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.010</span>
                  <span class="proto" style="color:var(--cyan)">LCP</span>
                  <span class="info">S→C Conf-Req (MRU=1480 MAGIC NUM=0x87abce00 Auth=PAP)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.012</span>
                  <span class="proto" style="color:var(--cyan)">LCP</span>
                  <span class="info">S→C Conf-Ack (MRU=1480 MAGIC NUM=0x12345678)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.012</span>
                  <span class="proto">LCP</span>
                  <span class="info">C→S Conf-Ack (MRU=1480 MAGIC NUM=0x87abce00)</span>
                </div>

                <div class="log-divider" style="margin-top:12px">Phase 2: Authenticate</div>

                <div class="packet-log">
                  <span class="time">0.015</span>
                  <span class="proto">PAP</span>
                  <span class="info">C→S Auth-Req (User/Pass)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.018</span>
                  <span class="proto" style="color:var(--cyan)">PAP</span>
                  <span class="info">S→C Auth-Ack (Success)</span>
                </div>

              </div>
            </div>
          </div>
        </section>

        <!-- Slide 4: IPCP deep -->
        <section class="slide inactive" data-index="3" id="s3">
          <div class="left">
            <div class="title">IPCP 深度解析（地址分配）</div>
            <div class="subtitle">NAK 机制：Client 请求 0.0.0.0 → Server 指派 IP</div>
            <div class="card" style="display:flex;flex-direction:column;gap:12px">
              <div class="muted">IP 地址协商流程：</div>

              <div class="summary-item">
                <div class="summary-icon">REQ</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Client Request (0.0.0.0)</div>
                  <div class="muted" style="font-size:12px">"I don't have an IP, please give me one"</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:var(--cyan)">NAK</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Server NAK (Suggestion)</div>
                  <div class="muted" style="font-size:12px">"No, use this IP: 192.168.1.100"</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon">REQ</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Client Request (Assigned)</div>
                  <div class="muted" style="font-size:12px">"Okay, I request 192.168.1.100"</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:var(--cyan)">ACK</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Server ACK</div>
                  <div class="muted" style="font-size:12px">"Agreed. Link is up."</div>
                </div>
              </div>

            </div>
          </div>
          <div class="right">
            <div class="card mock-phone">
              <div class="chip muted">IPCP • Protocol 0x8021</div>
              <div class="screen">
                <div class="log-divider">IP Assignment</div>

                <div class="packet-log">
                  <span class="time">0.020</span>
                  <span class="proto">IPCP</span>
                  <span class="info">C→S Conf-Req (IP=0.0.0.0)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.022</span>
                  <span class="proto" style="color:var(--cyan)">IPCP</span>
                  <span class="info">S→C Conf-Nak (IP=192.168.1.100)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.024</span>
                  <span class="proto">IPCP</span>
                  <span class="info">C→S Conf-Req (IP=192.168.1.100)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.026</span>
                  <span class="proto" style="color:var(--cyan)">IPCP</span>
                  <span class="info">S→C Conf-Ack (IP=192.168.1.100)</span>
                </div>

                <div class="log-divider" style="margin-top:12px">Server IP Info</div>

                <div class="packet-log">
                  <span class="time">0.026</span>
                  <span class="proto" style="color:var(--cyan)">IPCP</span>
                  <span class="info">S→C Conf-Req (IP=192.168.1.1)</span>
                </div>

                <div class="packet-log">
                  <span class="time">0.028</span>
                  <span class="proto">IPCP</span>
                  <span class="info">C→S Conf-Ack (IP=192.168.1.1)</span>
                </div>

              </div>
            </div>
          </div>
        </section>

        <!-- Slide 5: LCP Echo -->
        <section class="slide inactive" data-index="4" id="s4">
          <div class="left">
            <div class="title">LCP Echo 保活与脱落检测</div>
            <div class="subtitle">链路层心跳机制：定期探测，超时断连</div>
            <div class="card" style="display:flex;flex-direction:column;gap:12px">
              <div class="muted">LCP Echo 机制详解：</div>

              <div class="summary-item">
                <div class="summary-icon">ECHO</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Echo-Request</div>
                  <div class="muted" style="font-size:12px">Periodic Probe (e.g. every 10s)</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:var(--cyan)">REPLY</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Echo-Reply</div>
                  <div class="muted" style="font-size:12px">Must reflect Magic Number</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:#ef4444">DEAD</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Link Dead Detection</div>
                  <div class="muted" style="font-size:12px">No reply after N retries → Teardown</div>
                </div>
              </div>

              <div style="height:1px;background:rgba(255,255,255,0.1);margin:4px 0"></div>
              <div class="muted" style="font-size:12px">
                注：双方均可发送 Echo-Request。通常客户端和服务器都会定期检测对方。回复必须携带请求方的 Magic Number。
              </div>
            </div>
          </div>
          <div class="right">
            <div class="card mock-phone">
              <div class="chip muted">Keepalive • LCP 0xC021</div>
              <div class="screen">
                <div class="log-divider">Normal Keepalive</div>

                <div class="packet-log">
                  <span class="time">10.00</span>
                  <span class="proto">LCP</span>
                  <span class="info">C→S Echo-Req (Magic=0x12345678)</span>
                </div>

                <div class="packet-log">
                  <span class="time">10.00</span>
                  <span class="proto" style="color:var(--cyan)">LCP</span>
                  <span class="info">S→C Echo-Reply (Magic=0x12345678)</span>
                </div>

                <div class="log-divider" style="margin-top:12px">Link Loss Scenario</div>

                <div class="packet-log">
                  <span class="time">20.00</span>
                  <span class="proto">LCP</span>
                  <span class="info">C→S Echo-Req (Attempt 1)</span>
                </div>
                <!-- Missing reply -->
                <div class="packet-log">
                  <span class="time">23.00</span>
                  <span class="proto">LCP</span>
                  <span class="info">C→S Echo-Req (Attempt 2)</span>
                </div>

                <div class="packet-log">
                  <span class="time">26.00</span>
                  <span class="proto" style="color:#ef4444">SYS</span>
                  <span class="info">Timeout! Link Termination</span>
                </div>

              </div>
            </div>
          </div>
        </section>

        <!-- Slide 6: Troubleshooting & Summary -->
        <section class="slide inactive" data-index="5" id="s5">
          <div class="left">
            <div class="title">故障排查要点 & 总结</div>
            <div class="subtitle">Discovery / LCP / Magic Number 关键注意点</div>
            <div class="card" style="display:flex;flex-direction:column;gap:12px">
              <div class="muted">常见问题与规范：</div>

              <div class="summary-item">
                <div class="summary-icon">MAC</div>
                <div>
                  <div style="font-size:13px;font-weight:600">MAC 地址类型</div>
                  <div class="muted" style="font-size:12px">PADI 目的为广播 (FF:FF..)，其余均为单播</div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon">MAGIC</div>
                <div>
                  <div style="font-size:13px;font-weight:600">Magic Number 作用</div>
                  <div class="muted" style="font-size:12px">防环路（避免收到自己报文），切勿配错，在发送 Echo-Reply 时，必须携带请求方的 Magic Number
                  </div>
                </div>
              </div>

              <div class="summary-item">
                <div class="summary-icon" style="color:#ef4444">ZERO</div>
                <div>
                  <div style="font-size:13px;font-weight:600">非法值检测</div>
                  <div class="muted" style="font-size:12px">Magic Number 协商值不能为 0</div>
                </div>
              </div>

              <div style="height:1px;background:rgba(255,255,255,0.1);margin:4px 0"></div>
              <div class="muted" style="font-size:12px">
                总结：从 MAC 层单播/广播特性，到 LCP 层魔术字防环，细节决定拨号成败。
              </div>
            </div>
          </div>
          <div class="right">
            <div class="card mock-phone">
              <div class="chip muted">Checklist</div>
              <div class="screen">
                <div class="chip">PADI Dst == FF:FF:FF:FF:FF:FF</div>
                <div class="chip">PADO/PADR/etc == Unicast</div>
                <div class="chip">Magic Num != 0</div>
                <div class="chip">My Magic != Peer Magic</div>
              </div>
            </div>
          </div>
        </section>

      </div>

      <div class="nav">
        <button class="btn" id="prev">← Prev</button>
        <button class="btn" id="next">Next →</button>
      </div>
      <div class="pager" id="pager">1 / 6</div>
      <div class="progress"><i id="progressBar"></i></div>

      <div class="particles" aria-hidden="true">
        <div class="particle" style="left:10%;top:10%;width:120px;height:120px;opacity:0.12"></div>
        <div class="particle" style="left:70%;top:20%;width:80px;height:80px;opacity:0.08"></div>
        <div class="particle" style="left:50%;top:70%;width:140px;height:140px;opacity:0.05"></div>
      </div>

    </div>
  </div>

  <div class="modal" id="detailModal">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <div style="font-weight:700;font-size:16px">PPPoE Full Packet Flow</div>
        <div class="btn" style="padding:4px 8px;font-size:12px"
          onclick="document.getElementById('detailModal').classList.remove('open')">✕</div>
      </div>
      <div class="screen" style="background:rgba(0,0,0,0.3); padding:0">
        <div class="sequence-stage" id="seqStage">
          <div class="actor-line">
            <div class="actor-label">Client</div>
          </div>
          <div class="actor-line">
            <div class="actor-label">Server</div>
          </div>
          <!-- Messages will be injected here by JS -->
        </div>
      </div>
      <div style="margin-top:12px;text-align:center;font-size:12px;color:var(--muted)">
        Click anywhere outside to close
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Modal Logic
      const modal = document.getElementById('detailModal');
      const card = document.getElementById('overviewCard');

      card.addEventListener('click', () => {
        modal.classList.add('open');
        playAnimation();
      });

      modal.addEventListener('click', () => {
        modal.classList.remove('open');
      });

      // Animation Data
      const packets = [
        { divider: 'Discovery Stage • ETH 0x8863' },
        { t: '0.000', proto: 'PADI', info: 'Broadcast', dir: 'c2s' },
        { t: '0.002', proto: 'PADO', info: 'Offer (AC-Name)', dir: 's2c' },
        { t: '0.003', proto: 'PADR', info: 'Request', dir: 'c2s' },
        { t: '0.005', proto: 'PADS', info: 'Session ID: 0x1A2B', dir: 's2c' },
        { divider: 'Session Stage • ETH 0x8864' },
        { t: '0.010', proto: 'LCP', info: 'Conf-Req (Magic)', dir: 'c2s' },
        { t: '0.012', proto: 'LCP', info: 'Conf-Ack (OK)', dir: 's2c' },
        { t: '0.015', proto: 'PAP', info: 'Auth-Req (User)', dir: 'c2s' },
        { t: '0.018', proto: 'PAP', info: 'Auth-Ack (Success)', dir: 's2c' },
        { t: '0.020', proto: 'IPCP', info: 'Conf-Req (IP=0)', dir: 'c2s' },
        { t: '0.022', proto: 'IPCP', info: 'Conf-Nak (Sugg IP)', dir: 's2c' },
        { t: '0.025', proto: 'IPCP', info: 'Conf-Req (Accept)', dir: 'c2s' },
        { t: '0.028', proto: 'IPCP', info: 'Conf-Ack (Bound)', dir: 's2c' }
      ];

      function playAnimation() {
        const stage = document.getElementById('seqStage');
        // Keep only the actor lines
        const actors = Array.from(stage.querySelectorAll('.actor-line'));
        stage.innerHTML = '';
        actors.forEach(a => stage.appendChild(a));

        let delay = 0;
        let topOffset = 40;

        packets.forEach(p => {
          if (p.divider) {
            const div = document.createElement('div');
            div.className = 'log-divider';
            div.style.position = 'absolute';
            div.style.top = topOffset + 'px';
            div.style.left = '50%';
            div.style.transform = 'translateX(-50%)';
            div.style.zIndex = '10';
            div.textContent = p.divider;
            stage.appendChild(div);
            topOffset += 30;
            return;
          }

          const row = document.createElement('div');
          row.className = `seq-msg ${p.dir}`;
          row.style.top = topOffset + 'px';

          const color = p.dir === 's2c' ? 'var(--cyan)' : 'var(--accent)';

          const text = document.createElement('div');
          text.className = 'msg-text';
          text.innerHTML = `<span style="color:${color};font-weight:bold">${p.proto}</span> ${p.info}`;

          const time = document.createElement('div');
          time.className = 'msg-time';
          time.textContent = p.t;

          const arrow = document.createElement('div');
          arrow.className = 'arrow';

          row.appendChild(time);
          row.appendChild(text);
          row.appendChild(arrow);
          stage.appendChild(row);

          // Animate
          setTimeout(() => {
            row.classList.add('show');
            // Calculate width based on container but fixed for now
            arrow.style.width = 'calc(100% - 84px)';
          }, delay);

          delay += 600; // 600ms per step
          topOffset += 50;
        });
      }

      const slides = Array.from(document.querySelectorAll('.slide'));
      const total = slides.length;
      let idx = 0;
      const pager = document.getElementById('pager');
      const progress = document.getElementById('progressBar');
      function show(i) {
        slides.forEach(s => s.classList.add('inactive'));
        slides.forEach(s => s.classList.remove('active'));
        const s = slides[i];
        s.classList.remove('inactive');
        s.classList.add('active');
        idx = i;
        pager.textContent = (i + 1) + ' / ' + total;
        const pct = Math.round(((i) / (total - 1)) * 100);
        progress.style.width = pct + '%';
      }
      document.getElementById('next').addEventListener('click', () => show(Math.min(idx + 1, total - 1)));
      document.getElementById('prev').addEventListener('click', () => show(Math.max(idx - 1, 0)));
      document.addEventListener('keydown', e => {
        if (e.key === 'ArrowRight' || e.key === 'PageDown' || e.code === 'Space') {
          e.preventDefault(); show(Math.min(idx + 1, total - 1));
        }
        if (e.key === 'ArrowLeft' || e.key === 'PageUp') {
          e.preventDefault(); show(Math.max(idx - 1, 0));
        }
      });
      // touch swipe
      let startX = 0; document.addEventListener('touchstart', e => startX = e.touches[0].clientX);
      document.addEventListener('touchend', e => { const dx = (e.changedTouches[0].clientX - startX); if (dx < -40) show(Math.min(idx + 1, total - 1)); if (dx > 40) show(Math.max(idx - 1, 0)); });

      // click to start first slide animation
      show(0);
    })();
  </script>
</body>

</html>